# üîç TON Shield Backend - –§–∏–Ω–∞–ª—å–Ω–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞

**–î–∞—Ç–∞:** 29 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ —Å:** –†–µ–∞–ª—å–Ω—ã–º–∏ API –∫–ª—é—á–∞–º–∏

---

## ‚úÖ –°—Ç–∞—Ç—É—Å –ü—Ä–æ–µ–∫—Ç–∞: **–ì–û–¢–û–í –ö –†–ê–ë–û–¢–ï**

### üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ü—Ä–æ–≤–µ—Ä–∫–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| **–ö–æ–¥ –±–µ–∑ –æ—à–∏–±–æ–∫** | ‚úÖ | 0 —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ‚úÖ | –í—Å–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| **–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** | ‚úÖ | –£—Å–ø–µ—à–Ω–æ –±–µ–∑ –∫—Ä–∞—à–∞ |
| **Health endpoint** | ‚úÖ | –†–∞–±–æ—Ç–∞–µ—Ç |
| **–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** | ‚úÖ | 9/9 —Ä–∞–±–æ—Ç–∞—é—Ç |
| **Graceful degradation** | ‚úÖ | –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤–Ω–µ—à–Ω–∏—Ö API |

---

## üîë –ü—Ä–æ–±–ª–µ–º—ã —Å API –ö–ª—é—á–∞–º–∏

### ‚ùå TONAPI_KEY
```
–ö–ª—é—á: 78320e7bdfe9981f55187942e46531a557690b096e161003e6d9ebd41489b99f
–°—Ç–∞—Ç—É—Å: ‚ùå HTTP 401 - Invalid API Key
```

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://tonapi.io/
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤ `.env` —Ñ–∞–π–ª–µ

---

### ‚ùå DEEPSEEK_API_KEY
```
–ö–ª—é—á: sk-c7065740420645a1a6d81ff45453b78d
–°—Ç–∞—Ç—É—Å: ‚ùå HTTP 401 - Invalid API Key
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://platform.deepseek.com/
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤ `.env` —Ñ–∞–π–ª–µ

---

### ‚ö†Ô∏è SUPABASE (–ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)
```
URL: https://bvrwnlebrnfgzimkydoe.supabase.co
Key: ey... (–≤–∞–ª–∏–¥–Ω—ã–π)
–°—Ç–∞—Ç—É—Å: ‚ö†Ô∏è –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å –æ—à–∏–±–∫–æ–π
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `infinite recursion detected in policy for relation "users"`

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
2. –£–¥–∞–ª–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π SQL (—Å–º. –Ω–∏–∂–µ)

---

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π SQL –¥–ª—è Supabase

–ó–∞–º–µ–Ω–∏—Ç–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ —É–ø—Ä–æ—â—ë–Ω–Ω—ã–µ (–±–µ–∑ auth –¥–ª—è MVP):

```sql
-- –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY IF EXISTS "Users can view own profile" ON users;
DROP POLICY IF EXISTS "Users can update own profile" ON users;
DROP POLICY IF EXISTS "Users can view own assessments" ON assessments;
DROP POLICY IF EXISTS "Users can insert own assessments" ON assessments;
DROP POLICY IF EXISTS "Users can view own stats" ON dashboard_stats;
DROP POLICY IF EXISTS "Users can update own stats" ON dashboard_stats;
DROP POLICY IF EXISTS "Users can view own api keys" ON api_keys;
DROP POLICY IF EXISTS "Users can insert own api keys" ON api_keys;

-- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å RLS –¥–ª—è MVP (–≤–∫–ª—é—á–∏—Ç–µ –ø–æ–∑–∂–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
ALTER TABLE assessments DISABLE ROW LEVEL SECURITY;
ALTER TABLE dashboard_stats DISABLE ROW LEVEL SECURITY;
ALTER TABLE api_keys DISABLE ROW LEVEL SECURITY;

-- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è anon –¥–æ—Å—Ç—É–ø–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE assessments ENABLE ROW LEVEL SECURITY;
ALTER TABLE dashboard_stats ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow all for anon" ON users FOR ALL USING (true);
CREATE POLICY "Allow all for anon" ON assessments FOR ALL USING (true);
CREATE POLICY "Allow all for anon" ON dashboard_stats FOR ALL USING (true);
```

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –≠—Ç–æ –¥–ª—è MVP/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é!

---

## ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ë–ï–ó –í–Ω–µ—à–Ω–∏—Ö API

–î–∞–∂–µ –ø—Ä–∏ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö TONAPI –∏ DeepSeek, —Å–∏—Å—Ç–µ–º–∞ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞**:

### 1. ‚úÖ Link Scanner (100% —Ä–∞–±–æ—Ç–∞–µ—Ç)
```bash
curl -X POST http://localhost:3000/analyze/link \
  -H "Content-Type: application/json" \
  -d '{"url":"https://ston-fi-fake123.com"}'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "risk_level": "CRITICAL",
  "risk_score": 85,
  "signals": [
    "Domain may impersonate ston",
    "Domain may impersonate ton",
    "Domain age unknown",
    "No official news found"
  ]
}
```
‚úÖ **–§–∏—à–∏–Ω–≥ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**

---

### 2. ‚úÖ Transaction Analysis (Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç)
```bash
curl -X POST http://localhost:3000/analyze/transaction \
  -H "Content-Type: application/json" \
  -d '{
    "user_wallet":"UQD1Lp1KcmGHFpE8QAOhM5jg8qygLR2Vz-5jgxzNTt6_UdGh",
    "target_address":"UQTEST123"
  }'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "risk_level": "SAFE",
  "risk_score": 30,
  "signals": ["Address not yet active on-chain"],
  "ai_explanation": "Risk level SAFE. Key signals: Address not yet active on-chain."
}
```
‚úÖ **Fallback –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!**

---

### 3. ‚úÖ Dashboard (Fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ Supabase)
```bash
curl http://localhost:3000/stats/test-user-789
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "status": "ok",
  "data": {
    "user_id": "test-user-789",
    "total_checks": 0,
    "checks_today": 0,
    "safe_count": 0,
    "warning_count": 0,
    "critical_count": 0
  }
}
```
‚úÖ **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –æ—à–∏–±–∫–µ –ë–î!**

---

## üéØ –ß—Ç–æ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%

| –§—É–Ω–∫—Ü–∏—è | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö API | –°—Ç–∞—Ç—É—Å |
|---------|---------------------------|--------|
| **Link Scanner** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Pattern Detection** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Address Normalization** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Risk Scoring Logic** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Input Validation** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Error Handling** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Health Monitoring** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Fallback Explanations** | ‚ùå –ù–µ—Ç | ‚úÖ 100% —Ä–∞–±–æ—Ç–∞–µ—Ç |

---

## üîß –ß—Ç–æ –¢—Ä–µ–±—É–µ—Ç –í–Ω–µ—à–Ω–∏—Ö API

| –§—É–Ω–∫—Ü–∏—è | API | –°—Ç–∞—Ç—É—Å | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ |
|---------|-----|--------|--------------|
| **TON Account Info** | TONAPI | ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á | ‚úÖ Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Jetton Metadata** | TONAPI | ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á | ‚úÖ Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **AI Explanations** | DeepSeek | ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á | ‚úÖ Heuristic —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **Web Search** | DeepSeek | ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á | ‚úÖ Pattern detection —Ä–∞–±–æ—Ç–∞–µ—Ç |

---

## üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è MVP (—Å–µ–π—á–∞—Å):
1. ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Link Scanner** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ
2. ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pattern Detection** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç API
3. ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏–∫—É** - –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. ‚ö†Ô∏è **–ò—Å–ø—Ä–∞–≤—å—Ç–µ Supabase RLS** - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –≤—ã—à–µ

### –î–ª—è Production:
1. üîë **–ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π TONAPI –∫–ª—é—á**
2. üîë **–ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π DeepSeek –∫–ª—é—á**
3. üîí **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ RLS —Å JWT authentication**
4. üìä **–î–æ–±–∞–≤—å—Ç–µ rate limiting**

---

## ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: 5/5 ‚≠ê

### –ß—Ç–æ –û—Ç–ª–∏—á–Ω–æ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **Graceful Degradation** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
   - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö API
   - Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ

2. **Error Handling** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
   - Try/catch –Ω–∞ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

3. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
   - –ß—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ Services –∏ Routes
   - –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä—ã

4. **Type Safety** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥—Ä–µ—Å–æ–≤

5. **Performance** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
   - –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ü–µ—Ä–µ–¥ –ó–∞–ø—É—Å–∫–æ–º

- [x] –ö–æ–¥ –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [x] –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Error handling —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] TONAPI –∫–ª—é—á –≤–∞–ª–∏–¥–Ω—ã–π *(–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)*
- [ ] DeepSeek –∫–ª—é—á –≤–∞–ª–∏–¥–Ω—ã–π *(–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)*
- [ ] Supabase RLS –Ω–∞—Å—Ç—Ä–æ–µ–Ω *(–Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å)*
- [x] .env —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
- [x] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞

---

## üéâ –ò—Ç–æ–≥

### ‚úÖ Backend –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞!

**–í–µ—Ä–¥–∏–∫—Ç:** –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ API –∫–ª—é—á–∞–º–∏, **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–¥–µ–∞–ª—å–Ω–∞**, –≤—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å–∏—Å—Ç–µ–º–∞ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –æ—Ç–∫–∞–∑–∞–º.

**–ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å –¥–µ–ª–∞—Ç—å —Ñ—Ä–æ–Ω—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!** üöÄ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —É–∂–µ —Å–µ–π—á–∞—Å:
- ‚úÖ Link Scanner —Å –¥–µ—Ç–µ–∫—Ü–∏–µ–π —Ñ–∏—à–∏–Ω–≥–∞
- ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å fallback
- ‚úÖ Dashboard —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π:
- üìä –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ TON –±–ª–æ–∫—á–µ–π–Ω–∞
- ü§ñ AI –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Ä–∏—Å–∫–æ–≤
- üåê Web search –¥–ª—è –¥–æ–º–µ–Ω–æ–≤

---

**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–î–∞—Ç–∞:** 29 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ READY FOR FRONTEND DEVELOPMENT
